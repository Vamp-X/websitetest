<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Admin</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 100px auto;
            padding: 20px;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .project-list {
            margin-bottom: 40px;
        }
        
        .project-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .project-actions {
            display: flex;
            gap: 10px;
        }
        
        .admin-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <a href="index.html" class="logo"><span class="bracket">&lt;</span>JackVRO<span class="bracket">/&gt;</span></a>
            <ul class="nav-links">
                <li><a href="index.html">Back to Portfolio</a></li>
            </ul>
        </div>
    </nav>

    <div class="admin-container">
        <div class="admin-header">
            <h1>Portfolio Admin</h1>
            <button id="addProjectBtn" class="btn primary-btn">Add New Project</button>
        </div>

        <div class="project-list" id="projectList">
            <!-- Projects will be loaded here -->
            <div class="loading">Loading projects...</div>
        </div>

        <div class="admin-form" id="projectForm" style="display: none;">
            <h2 id="formTitle">Add New Project</h2>
            <form id="addEditProjectForm">
                <input type="hidden" id="projectId" name="id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="title">Project Title</label>
                        <input type="text" id="title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" name="category" required>
                            <option value="">Select Category</option>
                            <option value="web">Web Development</option>
                            <option value="app">App Development</option>
                            <option value="ui">UI/UX Design</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="4" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="imageUrl">Image URL</label>
                        <input type="text" id="imageUrl" name="imageUrl">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="projectUrl">Project URL</label>
                        <input type="text" id="projectUrl" name="projectUrl">
                    </div>
                    <div class="form-group">
                        <label for="githubUrl">GitHub URL</label>
                        <input type="text" id="githubUrl" name="githubUrl">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="tags">Tags (comma separated)</label>
                    <input type="text" id="tags" name="tags">
                </div>
                
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="featured" name="featured">
                    <label for="featured">Featured Project</label>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn primary-btn">Save Project</button>
                    <button type="button" id="cancelBtn" class="btn secondary-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // DOM Elements
        const projectList = document.getElementById('projectList');
        const projectForm = document.getElementById('projectForm');
        const addProjectBtn = document.getElementById('addProjectBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const addEditProjectForm = document.getElementById('addEditProjectForm');
        const formTitle = document.getElementById('formTitle');
        
        // State
        let projects = [];
        let editMode = false;
        
        // Fetch all projects
        async function fetchProjects() {
            try {
                const response = await fetch('/api/projects');
                projects = await response.json();
                renderProjects();
            } catch (error) {
                console.error('Error fetching projects:', error);
                projectList.innerHTML = '<div class="error">Error loading projects. Please try again.</div>';
            }
        }
        
        // Render projects in the list
        function renderProjects() {
            if (projects.length === 0) {
                projectList.innerHTML = '<div class="empty-state">No projects found. Add your first project!</div>';
                return;
            }
            
            projectList.innerHTML = projects.map(project => `
                <div class="project-item">
                    <div class="project-info">
                        <h3>${project.title}</h3>
                        <p>${project.category} | ${project.featured ? 'Featured' : 'Not Featured'}</p>
                    </div>
                    <div class="project-actions">
                        <button class="btn secondary-btn edit-btn" data-id="${project._id}">Edit</button>
                        <button class="btn danger-btn delete-btn" data-id="${project._id}">Delete</button>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => editProject(btn.dataset.id));
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteProject(btn.dataset.id));
            });
        }
        
        // Show form for adding a new project
        function showAddForm() {
            editMode = false;
            formTitle.textContent = 'Add New Project';
            addEditProjectForm.reset();
            document.getElementById('projectId').value = '';
            projectForm.style.display = 'block';
        }
        
        // Show form for editing a project
        function editProject(id) {
            editMode = true;
            formTitle.textContent = 'Edit Project';
            
            const project = projects.find(p => p._id === id);
            if (!project) return;
            
            document.getElementById('projectId').value = project._id;
            document.getElementById('title').value = project.title;
            document.getElementById('description').value = project.description;
            document.getElementById('imageUrl').value = project.imageUrl;
            document.getElementById('projectUrl').value = project.projectUrl;
            document.getElementById('githubUrl').value = project.githubUrl;
            document.getElementById('category').value = project.category;
            document.getElementById('tags').value = project.tags.join(', ');
            document.getElementById('featured').checked = project.featured;
            
            projectForm.style.display = 'block';
        }
        
        // Delete a project
        async function deleteProject(id) {
            if (!confirm('Are you sure you want to delete this project?')) return;
            
            try {
                const response = await fetch(`/api/projects/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    fetchProjects();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                console.error('Error deleting project:', error);
                alert('An error occurred. Please try again.');
            }
        }
        
        // Handle form submission
        addEditProjectForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(addEditProjectForm);
            const projectData = {
                title: formData.get('title'),
                description: formData.get('description'),
                imageUrl: formData.get('imageUrl'),
                projectUrl: formData.get('projectUrl'),
                githubUrl: formData.get('githubUrl'),
                category: formData.get('category'),
                tags: formData.get('tags').split(',').map(tag => tag.trim()).filter(tag => tag),
                featured: formData.get('featured') === 'on'
            };
            
            try {
                let response;
                
                if (editMode) {
                    const id = formData.get('id');
                    response = await fetch(`/api/projects/${id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(projectData)
                    });
                } else {
                    response = await fetch('/api/projects', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(projectData)
                    });
                }
                
                if (response.ok) {
                    projectForm.style.display = 'none';
                    fetchProjects();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                console.error('Error saving project:', error);
                alert('An error occurred. Please try again.');
            }
        });
        
        // Event Listeners
        addProjectBtn.addEventListener('click', showAddForm);
        cancelBtn.addEventListener('click', () => {
            projectForm.style.display = 'none';
        });
        
        // Initialize
        fetchProjects();
    </script>
</body>
</html>